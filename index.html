<!DOCTYPE html>
<html>
  <head>
    <title>gbuesing.github.com</title>
    <meta name="viewport" content="width=device-width, maximum-scale=1.0" />
    <style>
    pre {
      float: left; 
      border: 1px dotted #ccc;
    }
    </style>
  </head>
  <body>
    <pre></pre>
  </body>
  <script>
  
  function gameOfLife(pattern) {
  
    // TODO: add patterns. No need to include entire universe in pattern.
    var patterns = {
      'gun': [
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                     *                                     ',
        '                                                  ****    *                                ',
        '                                         *       ****     *                                ',
        '                                        * *      *  *         **                           ',
        '                                       *   **    ****         **                           ',
        '                            **         *   **     ****                                     ',
        '                            **         *   **        *                                     ',
        '                                        * *                                                ',
        '                                         *                                                 ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           ',
        '                                                                                           '
      ]
    };
  
    var currentGeneration = patterns[pattern];
  
    function calculateNextGeneration() {
      var nextGeneration = [];
      for (var y=0; y < currentGeneration.length; y++) {
        var line = currentGeneration[y];
        var nextCells = [];
        for (var x=0; x < line.length; x++) {
          var nextCell = isCellAliveInNextGeneration(x,y) ? '*' : ' ';
          nextCells.push(nextCell);
        }
        nextGeneration[y] = nextCells.join('');
      }
      return nextGeneration;
    }
  
    function isCellAlive(x,y) {
      return getCell(x,y) === '*';
    }
  
    function isCellAliveInNextGeneration(x,y) {
      var aliveNeighbors = countAliveNeighbors(x,y);
    
      if (isCellAlive(x,y)) {
        return aliveNeighbors === 2 || aliveNeighbors === 3;
      } else {
        return aliveNeighbors === 3;
      }
    }
  
    var neighborOffsets = [[-1, 0],[1, 0],[-1, 1],[0, 1],[1, 1],[-1, -1],[0, -1], [1, -1]];
  
    function countAliveNeighbors(x,y) {
      var sum = 0;
      neighborOffsets.forEach(function(pair) {
        var offset_x = pair[0], offset_y = pair[1];
        if (isCellAlive(x + offset_x, y + offset_y)) sum ++;
      });
      return sum;
    }
  
    function getCell(x,y) {
      var line = atIndex(currentGeneration, y);
      return atIndex(line, x);
    }
  
    // enables wraparound lookups on arrays and strings
    // fyi will not work with unicode strings!
    function atIndex(arr, i) { 
      var length = arr.length;
      if (i >= length) {
        return arr[i - length];
      } else if (i < 0) {
        return arr[length + i];
      } else {
       return arr[i];
      }
    }    
    
    return {
      next: function() {
        currentGeneration = calculateNextGeneration();
      },
      toString: function() {
        return currentGeneration.join("\n")
      }
    }
  }

  var game = gameOfLife('gun');
  
  var elem = document.getElementsByTagName("pre")[0];
  
  setInterval(function() {
    game.next();
    elem.textContent = game.toString();
  }, 100);
  </script>
</html>